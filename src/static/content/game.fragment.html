<div class="configuration">
    <h2>
        rubbrl4zr
    </h2>

    <div>
        <div id="previewWrapper">
            <canvas id="preview" height="400"></canvas>
        </div>
    </div>

    <div style="float: right"><span id="current-frequency">1</span> Hz</div>
    <label for="frequency">Frequency</label>
    <input id="frequency" type="range" min="1" max="21" step="1" />

    <div style="float: right"><span id="current-amplitude">50</span> %</div>
    <label for="amplitude">Amplitude</label>
    <input id="amplitude" type="range" min="0" max="100" step="5" />

    <div style="float: right"><span id="current-phase">50</span> %</div>
    <label for="phase">Phase</label>
    <input id="phase" type="range" min="0" max="100" step="5" />

    <div style="float: right"><span id="current-rotation">45</span> °</div>
    <label for="rotation">Rotation</label>
    <input id="rotation" type="range" min="0" max="90" value="45"/>

    <div class="ready-box">
        <div class="playerlamp on"></div>
        <div class="playerlamp on"></div>
        <div class="playerlamp on"></div>
        <div class="playerlamp on"></div>
        <div class="playerlamp on"></div>
        <div class="playerlamp on"></div>
        <div class="playerlamp on"></div>
        <div class="playerlamp on"></div>
        <button id="rdy-btn"></button>
        <!-- 29s
        <br />
        <span>0/4 Players are ready</span> -->
    </div>
</div>

<canvas id="game">
    Gamefield should be here
</canvas>


<script src="/static/PreviewSinus.js"></script>
<script src="/static/Player.js"></script>
<script src="/static/Renderable.js"></script>
<script src="/static/SinusLaser.js"></script>

<script type="application/javascript">
const drawPreview = ()=> {
    let height = 200;
    let width = 400;
    let xAxis = 0;
    let yAxis = Math.floor(width/4);
    let canvas = document.getElementById("preview");
    let preview = new PreviewSinus({canvas,height,width,xAxis,yAxis});
}

// let Player1 = new Player(42, "Carsten", new Renderable("/static/img/ship-red.png", new Vector(20 ,0 ),0),"#FF0000");
// let Player2 = new Player(43, "Ötchen", new Renderable("/static/img/ship-blue.png", new Vector(800 - 50,0),90),"#0066FF");
// let Player3 = new Player(44, "Timo", new Renderable("/static/img/ship-green.png", new Vector(800 -50 ,600 -70),180),"#00FF00");
// let Player4 = new Player(45, "janNiklas", new Renderable("/static/img/ship-yellow.png", new Vector(20 ,600 -70),270),"#FFFF00");

var game = new Game(document.getElementById("game"), document.getElementById('preview'), []);

function loadPlayers(){
    for(var player of lib.players) {
        game.addPlayer(player.name);
    }
}

if(lib.players.length == 0) {
    lib.ajax("GET", "/players/"+lib.gameId, function(data) {
        let players = JSON.parse(data);
        lib.players = players;
        loadPlayers();
    });
}
else {
    loadPlayers();
}

game._obstacles.push(new Asteroid(42, new Vector(350,350)));

// TODO: don't put this into obstacles, but into a separate list of renderable objects
game._obstacles.push(new Explosion(42, new Vector(450,450)));

game.run();
lib.loopMusic("/static/snd/music01.mp3");

let amp = 30;
let fre = 30;

document.getElementById('frequency').addEventListener('input', function(e) {
    document.getElementById('current-frequency').innerHTML = e.target.value;

    this.fre = 80 / e.target.value;
    let laser = game.createPreviewLaser(null, this.fre, this.amp);
    game._previewLaser = laser;
    game.createLaser(game.getOwnPlayer());
}.bind(this));

document.getElementById('amplitude').addEventListener('input', function(e) {
    document.getElementById('current-amplitude').innerHTML = e.target.value;

   this.amp = e.target.value;
    let laser = game.createPreviewLaser(null, this.fre,this.amp);
    game._previewLaser = laser;
    game.createLaser(game.getOwnPlayer());

}.bind(this));

document.getElementById('phase').addEventListener('input', function(e) {
    document.getElementById('current-phase').innerHTML = e.target.value;
});

document.getElementById('rotation').addEventListener('input', function (e) {
    document.getElementById('current-rotation').innerHTML = e.target.value;
    game.getOwnPlayer().set_degree(e.target.value);
      game.createLaser(game.getOwnPlayer());

});

</script>
